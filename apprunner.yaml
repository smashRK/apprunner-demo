version: 1.0
applications:
  - name: backend
    runtime: corretto17
    build:
      commands:
        preBuild:
          - echo "Starting build process..."
          - java -version
          - mvn -version
        build:
          - echo "Running Maven build..."
          - mvn clean package -DskipTests
          - echo "Renaming JAR for consistency..."
          - cp target/*.jar target/app.jar
          - echo "Build completed, checking target directory..."
          - ls -la target/
      output:
        - target/app.jar
    source:
      directory: poccurd
    start:
      command: |
        echo "Changing to application directory..." &&
        cd /var/task/poccurd &&
        echo "Current directory: $(pwd)" &&
        chmod +x target/app.jar &&
        echo "Starting Spring Boot application..." &&
        java -jar target/app.jar
    port: 8080
    instanceConfiguration:
      cpu: 1
      memory: 2048
    env:
      - name: SPRING_PROFILES_ACTIVE
        value: "prod"
      - name: LOGGING_LEVEL_ROOT
        value: "DEBUG"
      - name: LOGGING_LEVEL_ORG_SPRINGFRAMEWORK
        value: "DEBUG"
      - name: LOGGING_LEVEL_COM_EXAMPLE
        value: "TRACE"
      - name: SPRING_JPA_SHOW_SQL
        value: "true"
      - name: SPRING_JPA_PROPERTIES_HIBERNATE_FORMAT_SQL
        value: "true"
    healthCheck:
      path: "/actuator/health"
      healthyThreshold: 1
      unhealthyThreshold: 5
      interval: 30
      timeout: 10

routes:
  - path: "/api/*"
    service: backend
